var se=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var E=(c,e,u)=>e in c?se(c,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[e]=u,b=(c,e)=>{for(var u in e||(e={}))ie.call(e,u)&&E(c,u,e[u]);if(N)for(var u of N(e))me.call(e,u)&&E(c,u,e[u]);return c},w=(c,e)=>le(c,re(e));import{C as ue,z as ce,aN as de,B as S,k as _,E as v,H as pe,I as _e,N as L,aT as ge,O as Ie,r as m,o as x,l as M,w as r,f as o,u as t,h as j,x as q,i as z,t as A,j as G,m as fe,P as ve}from"./vendor.5f3776de.js";import{p as Be,q as $e,c as be,b as ye,e as he,g as Ve}from"./main.84e42544.js";import{_ as Te}from"./ItemUnitModal.8774674a.js";const we=["onSubmit"],Ue={setup(c){const e=Be(),u=$e(),y=be(),D=ye(),{t:p}=ue(),h=ce(),H=de(),R=he(),f=S(!1),V=S(D.selectedCompanySettings.tax_per_item);let l=S(!1);e.$reset(),X();const B=_({get:()=>e.currentItem.price/100,set:a=>{e.currentItem.price=Math.round(a*100)}}),T=_({get:()=>{var a,n;return(n=(a=e==null?void 0:e.currentItem)==null?void 0:a.taxes)==null?void 0:n.map(d=>{if(d)return w(b({},d),{tax_type_id:d.id,tax_name:d.name+" ("+d.percent+"%)"})})},set:a=>{e.currentItem.taxes=a}}),$=_(()=>h.name==="items.edit"),C=_(()=>$.value?p("items.edit_item"):p("items.new_item")),Y=_(()=>u.taxTypes.filter(n=>!["sgst","cgst"].includes(n.name.toLowerCase())).map(n=>(console.log(n.name),w(b({},n),{tax_type_id:n.id,tax_name:n.name+" ("+n.percent+"%)"})))),O=_(()=>V.value==="YES"),F=_(()=>({currentItem:{name:{required:v.withMessage(p("validation.required"),pe),minLength:v.withMessage(p("validation.name_min_length",{count:3}),_e(3))},hsn_sac:{maxLength:v.withMessage(p("validation.invalid_hsn",{count:8}),L(8)),numeric:v.withMessage(p("validation.numbers_only"),ge)},description:{maxLength:v.withMessage(p("validation.description_maxlength"),L(65e3))}}})),i=Ie(F,e);async function W(){y.openModal({title:p("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function X(){if(l.value=!0,await e.fetchItemUnits({limit:"all"}),R.hasAbilities(Ve.VIEW_TAX_TYPE)&&await u.fetchTaxTypes({limit:"all"}),$.value){let a=h.params.id;await e.fetchItem(a),e.currentItem.tax_per_item===1?V.value="YES":V.value="NO"}l.value=!1}async function J(){if(i.value.currentItem.$touch(),i.value.currentItem.$invalid)return!1;f.value=!0;try{let n=b({id:h.params.id},e.currentItem);e.currentItem&&e.currentItem.taxes&&(n.taxes=e.currentItem.taxes.map(g=>({tax_type_id:g.tax_type_id,amount:B.value*g.percent,percent:g.percent,name:g.name,collective_tax:0}))),await($.value?e.updateItem:e.addItem)(n),f.value=!1,H.push("/admin/items"),a()}catch{f.value=!1;return}function a(){y.closeModal(),setTimeout(()=>{e.resetCurrentItem(),y.$reset(),i.value.$reset()},300)}}return(a,n)=>{const d=m("BaseBreadcrumbItem"),g=m("BaseBreadcrumb"),K=m("BasePageHeader"),U=m("BaseInput"),I=m("BaseInputGroup"),Q=m("BaseMoney"),P=m("BaseIcon"),Z=m("BaseSelectAction"),k=m("BaseMultiselect"),ee=m("BaseTextarea"),te=m("BaseButton"),ne=m("BaseInputGrid"),ae=m("BaseCard"),oe=m("BasePage");return x(),M(oe,null,{default:r(()=>[o(K,{title:t(C)},{default:r(()=>[o(g,null,{default:r(()=>[o(d,{title:a.$t("general.home"),to:"dashboard"},null,8,["title"]),o(d,{title:a.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),o(d,{title:t(C),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(Te),j("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:ve(J,["prevent"])},[o(ae,{class:"w-full"},{default:r(()=>[o(ne,{layout:"one-column"},{default:r(()=>[o(I,{label:a.$t("items.name"),"content-loading":t(l),required:"",error:t(i).currentItem.name.$error&&t(i).currentItem.name.$errors[0].$message},{default:r(()=>[o(U,{modelValue:t(e).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=s=>t(e).currentItem.name=s),"content-loading":t(l),invalid:t(i).currentItem.name.$error,onInput:n[1]||(n[1]=s=>t(i).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(I,{label:a.$t("items.hsn_sac"),"content-loading":t(l),error:t(i).currentItem.hsn_sac.$error&&t(i).currentItem.hsn_sac.$errors[0].$message},{default:r(()=>[o(U,{modelValue:t(e).currentItem.hsn_sac,"onUpdate:modelValue":n[2]||(n[2]=s=>t(e).currentItem.hsn_sac=s),"content-loading":t(l),invalid:t(i).currentItem.hsn_sac.$error,onInput:n[3]||(n[3]=s=>t(i).currentItem.hsn_sac.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(I,{label:a.$t("items.price"),"content-loading":t(l)},{default:r(()=>[o(Q,{modelValue:t(B),"onUpdate:modelValue":n[4]||(n[4]=s=>q(B)?B.value=s:null),"content-loading":t(l)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(I,{"content-loading":t(l),label:a.$t("items.unit")},{default:r(()=>[o(k,{modelValue:t(e).currentItem.unit_id,"onUpdate:modelValue":n[5]||(n[5]=s=>t(e).currentItem.unit_id=s),"content-loading":t(l),label:"name",options:t(e).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:a.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:r(()=>[o(Z,{onClick:W},{default:r(()=>[o(P,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),z(" "+A(a.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),t(O)?(x(),M(I,{key:0,label:a.$t("items.taxes"),"content-loading":t(l)},{default:r(()=>[o(k,{modelValue:t(T),"onUpdate:modelValue":n[6]||(n[6]=s=>q(T)?T.value=s:null),"content-loading":t(l),options:t(Y),mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):G("",!0),o(I,{label:a.$t("items.description"),"content-loading":t(l),error:t(i).currentItem.description.$error&&t(i).currentItem.description.$errors[0].$message},{default:r(()=>[o(ee,{modelValue:t(e).currentItem.description,"onUpdate:modelValue":n[7]||(n[7]=s=>t(e).currentItem.description=s),"content-loading":t(l),name:"description",row:2,rows:"2",onInput:n[8]||(n[8]=s=>t(i).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),j("div",null,[o(te,{"content-loading":t(l),type:"submit",loading:f.value},{left:r(s=>[f.value?G("",!0):(x(),M(P,{key:0,name:"SaveIcon",class:fe(s.class)},null,8,["class"]))]),default:r(()=>[z(" "+A(t($)?a.$t("items.update_item"):a.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],40,we)]),_:1})}}};export{Ue as default};
