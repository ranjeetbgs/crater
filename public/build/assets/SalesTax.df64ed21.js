var Be=Object.defineProperty,Ie=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var ye=(t,s,e)=>s in t?Be(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,z=(t,s)=>{for(var e in s||(s={}))Pe.call(s,e)&&ye(t,e,s[e]);if(pe)for(var e of pe(s))Te.call(s,e)&&ye(t,e,s[e]);return t},Y=(t,s)=>Ie(t,ke(s));import{q as ee,c as J,e as ae,b as te,p as fe,g as ne,T as Ce,k as Me,u as Ae,d as De}from"./main.84e42544.js";import{D as Ve,d as je}from"./DragIcon.3cc40856.js";import{B as X,a0 as xe,ah as re,C as Z,k as I,Y as le,r as y,o as i,e as $,h as n,t as _,f as a,Q as qe,u as o,w as c,i as U,l as j,j as N,z as Ue,X as G,E as O,H as Q,b2 as ge,N as se,aX as Ee,O as ie,x as H,F as K,y as oe,G as he,a7 as Ne,R as Oe,m as W,T as Le,S as ze,U as Fe,I as Re,aT as Ye,Z as _e,P as be}from"./vendor.5f3776de.js";import{_ as Xe}from"./SelectNotePopup.bf5ac7c8.js";const Qe={class:"flex items-center justify-between mb-3"},We={class:"flex items-center text-base",style:{flex:"4"}},Je={class:"pr-2 mb-0",align:"right"},Ze={class:"absolute left-3.5"},Ge={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},He=n("br",null,null,-1),Ke={class:"text-sm text-right",style:{flex:"3"}},et={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},tt={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:s}){const e=t,r=ee(),S=J(),v=ae(),w=X(null),f=xe(z({},e.taxData));re("utils");const{t:A}=Z(),p=I(()=>r.taxTypes.map(u=>z({},u)).map(u=>(e.taxes.find(x=>x.tax_type_id===u.id)?u.disabled=!0:u.disabled=!1,u))),V=I(()=>f.compound_tax&&e.total?(e.total+e.totalTax)*f.percent/100:e.total&&f.percent?e.total*f.percent/100:0);le(()=>e.total,()=>{C()}),le(()=>e.totalTax,()=>{C()}),e.taxData.tax_type_id>0&&(w.value=r.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),C();function D(m){f.percent=m.percent,f.tax_type_id=m.id,f.compound_tax=m.compound_tax,f.name=m.name,C()}function C(){f.tax_type_id!==0&&s("update",{index:e.index,item:Y(z({},f),{amount:V.value})})}function d(){let m={itemIndex:e.itemIndex,taxIndex:e.index};S.openModal({title:A("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function l(m){e.store.$patch(u=>{u[e.storeProp].items[e.itemIndex].taxes.splice(m,1)})}return(m,u)=>{const P=y("BaseIcon"),x=y("BaseMultiselect"),T=y("BaseFormatMoney");return i(),$("div",Qe,[n("div",We,[n("label",Je,_(m.$t("invoices.item.tax")),1),a(x,{modelValue:w.value,"onUpdate:modelValue":[u[0]||(u[0]=M=>w.value=M),u[1]||(u[1]=M=>D(M))],"value-prop":"id",options:o(p),placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},qe({singlelabel:c(({value:M})=>[n("div",Ze,_(M.name)+" - "+_(M.percent)+" % ",1)]),option:c(({option:M})=>[U(_(M.name)+" - "+_(M.percent)+" % ",1)]),_:2},[o(v).hasAbilities(t.ability)?{name:"action",fn:c(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:d},[a(P,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Ge,_(m.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),He]),n("div",Ke,[a(T,{amount:o(V),currency:t.currency},null,8,["amount","currency"])]),n("div",et,[t.taxes.length&&t.index!==t.taxes.length-1?(i(),j(P,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:u[2]||(u[2]=M=>l(t.index))})):N("",!0)])])}}},st={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},ot={colspan:"6",class:"p-0 text-left align-top"},at={class:"w-full"},nt=n("col",{style:{width:"30%","min-width":"240px"}},null,-1),rt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),lt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),it=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),dt={key:0,style:{width:"15%","min-width":"160px"}},ct=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),ut={class:"px-5 py-4 text-left align-top"},mt={class:"flex justify-start"},pt={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},yt={class:"px-5 py-4 text-right align-top"},ft={class:"px-5 py-4 text-right align-top"},xt={class:"px-5 py-4 text-left align-top"},gt={class:"flex flex-col"},ht={class:"flex-auto flex-fill bd-highlight"},_t={class:"relative w-full"},bt={key:0,class:"px-5 py-4 text-left align-top"},vt={class:"flex flex-col"},$t={class:"flex",style:{width:"120px"},role:"group"},wt={class:"flex items-center"},St={class:"px-5 py-4 text-right align-top"},Bt={class:"flex items-center justify-end text-sm"},It={class:"flex items-center justify-center w-6 h-10 mx-2"},kt={key:0},Pt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),Tt=["colspan"],Ct=["colspan"],Mt={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:s}){const e=t,r=te(),S=fe();Ue();const{t:v}=Z(),w=I({get:()=>e.itemData.quantity,set:g=>{q("quantity",parseFloat(g))}}),f=I({get:()=>{const g=e.itemData.price;return parseFloat(g)>0?g/100:g},set:g=>{if(parseFloat(g)>0){let B=Math.round(g*100);q("price",B)}else q("price",g)}}),A=I(()=>e.itemData.price*e.itemData.quantity),p=I({get:()=>e.itemData.discount,set:g=>{e.itemData.discount_type==="percentage"?q("discount_val",A.value*g/100):q("discount_val",Math.round(g*100)),q("discount",g)}}),V=I(()=>A.value-e.itemData.discount_val),D=I(()=>e.currency?e.currency:r.selectedCompanyCurrency),C=I(()=>e.store[e.storeProp].items.length!=1),d=I(()=>Math.round(G.exports.sumBy(e.itemData.taxes,function(g){return g.compound_tax?0:g.amount}))),l=I(()=>Math.round(G.exports.sumBy(e.itemData.taxes,function(g){return g.compound_tax?g.amount:0}))),m=I(()=>d.value+l.value),u={name:{required:O.withMessage(v("validation.required"),Q)},quantity:{required:O.withMessage(v("validation.required"),Q),minValue:O.withMessage(v("validation.qty_must_greater_than_zero"),ge(0)),maxLength:O.withMessage(v("validation.amount_maxlength"),se(20))},price:{required:O.withMessage(v("validation.required"),Q),minValue:O.withMessage(v("validation.number_length_minvalue"),ge(1)),maxLength:O.withMessage(v("validation.price_maxlength"),se(20))},discount_val:{between:O.withMessage(v("validation.discount_maxlength"),Ee(0,I(()=>A.value)))},description:{maxLength:O.withMessage(v("validation.notes_maxlength"),se(65e3))}},P=ie(u,I(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function x(g){e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes[g.index]=g.item});let B=e.itemData.taxes[e.itemData.taxes.length-1];(B==null?void 0:B.tax_type_id)!==0&&e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes.push(Y(z({},Ce),{id:he.raw()}))}),k()}function T(g){q("name",g)}function M(g){console.log(g),e.store.$patch(B=>{if(B[e.storeProp].items[e.index].name=g.name,B[e.storeProp].items[e.index].hsn_sac=g.hsn_sac,B[e.storeProp].items[e.index].price=g.price,B[e.storeProp].items[e.index].item_id=g.id,B[e.storeProp].items[e.index].description=g.description,g.unit&&(B[e.storeProp].items[e.index].unit_name=g.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&g.taxes){let L=0;g.taxes.forEach(R=>{x({index:L,item:z({},R)}),L++})}B[e.storeProp].exchange_rate&&(B[e.storeProp].items[e.index].price/=B[e.storeProp].exchange_rate)}),S.fetchItems(),k()}function h(){e.itemData.discount_type!=="fixed"&&(q("discount_val",Math.round(e.itemData.discount*100)),q("discount_type","fixed"))}function b(){e.itemData.discount_type!=="percentage"&&(q("discount_val",A.value*e.itemData.discount/100),q("discount_type","percentage"))}function k(){var L,R;let g=(R=(L=e.store[e.storeProp])==null?void 0:L.items[e.index])==null?void 0:R.taxes;g||(g=[]);let B=Y(z({},e.store[e.storeProp].items[e.index]),{index:e.index,total:V.value,sub_total:A.value,totalSimpleTax:d.value,totalCompoundTax:l.value,totalTax:m.value,tax:m.value,taxes:[...g]});e.store.updateItem(B)}function q(g,B){e.store.$patch(L=>{L[e.storeProp].items[e.index][g]=B}),k()}return(g,B)=>{const L=y("BaseItemSelect"),R=y("BaseInput"),E=y("BaseMoney"),de=y("BaseIcon"),ve=y("BaseButton"),ce=y("BaseDropdownItem"),$e=y("BaseDropdown"),ue=y("BaseContentPlaceholdersText"),me=y("BaseContentPlaceholders"),we=y("BaseFormatMoney");return i(),$("tr",st,[n("td",ot,[n("table",at,[n("colgroup",null,[nt,rt,lt,it,t.store[t.storeProp].discount_per_item==="YES"?(i(),$("col",dt)):N("",!0),ct]),n("tbody",null,[n("tr",null,[n("td",ut,[n("div",mt,[n("div",pt,[a(Ve)]),a(L,{type:"Invoice",item:t.itemData,invalid:o(P).name.$error,"invalid-description":o(P).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:T,onSelect:M},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",yt,[a(R,{modelValue:t.itemData.hsn_sac,"onUpdate:modelValue":B[0]||(B[0]=F=>t.itemData.hsn_sac=F),"content-loading":t.loading,small:"",onChange:B[1]||(B[1]=F=>k())},null,8,["modelValue","content-loading"])]),n("td",ft,[a(R,{modelValue:o(w),"onUpdate:modelValue":B[2]||(B[2]=F=>H(w)?w.value=F:null),invalid:o(P).quantity.$error,"content-loading":t.loading,type:"number",small:"",min:"0",step:"any",onChange:B[3]||(B[3]=F=>k()),onInput:B[4]||(B[4]=F=>o(P).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",xt,[n("div",gt,[n("div",ht,[n("div",_t,[a(E,{key:o(D),modelValue:o(f),"onUpdate:modelValue":B[5]||(B[5]=F=>H(f)?f.value=F:null),invalid:o(P).price.$error,"content-loading":t.loading,currency:o(D)},null,8,["modelValue","invalid","content-loading","currency"])])])])]),t.store[t.storeProp].discount_per_item==="YES"?(i(),$("td",bt,[n("div",vt,[n("div",$t,[a(R,{modelValue:o(p),"onUpdate:modelValue":B[6]||(B[6]=F=>H(p)?p.value=F:null),invalid:o(P).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),a($e,{position:"bottom-end"},{activator:c(()=>[a(ve,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",wt,[U(_(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),a(de,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:c(()=>[a(ce,{onClick:h},{default:c(()=>[U(_(g.$t("general.fixed")),1)]),_:1}),a(ce,{onClick:b},{default:c(()=>[U(_(g.$t("general.percentage")),1)]),_:1})]),_:1})])])])):N("",!0),n("td",St,[n("div",Bt,[n("span",null,[t.loading?(i(),j(me,{key:0},{default:c(()=>[a(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),j(we,{key:1,amount:o(V),currency:o(D)},null,8,["amount","currency"]))]),n("div",It,[o(C)?(i(),j(de,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:B[7]||(B[7]=F=>t.store.removeItem(t.index))})):N("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(i(),$("tr",kt,[Pt,n("td",{colspan:t.store[t.storeProp].discount_per_item==="YES"?2:1,class:"px-5 py-4 text-left align-top"},null,8,Tt),n("td",{colspan:t.store[t.storeProp].discount_per_item==="YES"?3:4,class:"px-5 py-4 text-left align-top"},[t.loading?(i(),j(me,{key:0},{default:c(()=>[a(ue,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(i(!0),$(K,{key:1},oe(t.itemData.taxes,(F,Se)=>(i(),j(tt,{key:F.id,index:Se,"item-index":t.index,"tax-data":F,taxes:t.itemData.taxes,"discounted-total":o(V),"total-tax":o(d),total:o(A),currency:t.currency,"update-items":k,ability:o(ne).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,onUpdate:x},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop"]))),128))],8,Ct)])):N("",!0)])])])])}}},At={class:"text-center item-table min-w-full"},Dt=n("col",{style:{width:"30%","min-width":"240px"}},null,-1),Vt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),jt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),qt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ut={key:0,style:{width:"15%","min-width":"160px"}},Et=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Nt={class:"bg-white border border-gray-200 border-solid"},Ot={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Lt={key:1,class:"pl-7"},zt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ft={key:1},Rt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Yt={key:1},Xt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Qt={key:1},Wt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Jt={key:1},Zt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Gt={key:1,class:"pr-10 column-heading"},ro={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const s=t,e=te(),r=I(()=>s.currency?s.currency:e.selectedCompanyCurrency);return(S,v)=>{const w=y("BaseContentPlaceholdersText"),f=y("BaseContentPlaceholders"),A=y("BaseIcon");return i(),$(K,null,[n("table",At,[n("colgroup",null,[Dt,Vt,jt,qt,t.store[t.storeProp].discount_per_item==="YES"?(i(),$("col",Ut)):N("",!0),Et]),n("thead",Nt,[n("tr",null,[n("th",Ot,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Lt,_(S.$tc("items.item",2)),1))]),n("th",zt,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Ft,_(S.$t("invoices.item.hsn_sac")),1))]),n("th",Rt,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Yt,_(S.$t("invoices.item.quantity")),1))]),n("th",Xt,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Qt,_(S.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(i(),$("th",Wt,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Jt,_(S.$t("invoices.item.discount")),1))])):N("",!0),n("th",Zt,[t.isLoading?(i(),j(f,{key:0},{default:c(()=>[a(w,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Gt,_(S.$t("invoices.item.amount")),1))])])]),a(o(je),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":v[0]||(v[0]=p=>t.store[t.storeProp].items=p),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:p,index:V})=>[a(Mt,{key:p.id,index:V,"item-data":p,loading:t.isLoading,currency:o(r),"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"])]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:v[1]||(v[1]=(...p)=>t.store.addItem&&t.store.addItem(...p))},[a(A,{name:"PlusCircleIcon",class:"mr-2"}),U(" "+_(S.$t("general.add_new_item")),1)])],64)}}},Ht={class:"flex items-center justify-between w-full mt-2 text-sm"},Kt={class:"font-semibold leading-5 text-gray-500 uppercase"},es={class:"flex items-center justify-center text-lg text-black"},ts={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:s}){const e=t;re("$utils");const r=I(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Ne(()=>{e.store.getSubtotalWithDiscount&&S(),e.store.getTotalSimpleTax&&S()});function S(){s("update",Y(z({},e.tax),{amount:r.value}))}return(v,w)=>{const f=y("BaseFormatMoney"),A=y("BaseIcon");return i(),$("div",Ht,[n("label",Kt,_(t.tax.name)+" ("+_(t.tax.percent)+" %) ",1),n("label",es,[a(f,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),a(A,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:w[0]||(w[0]=p=>v.$emit("remove",t.tax.id))})])])}}},ss={class:"w-full mt-4 tax-select"},os={class:"relative w-full max-w-md px-4"},as={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},ns={class:"relative bg-white"},rs={class:"relative p-4"},ls={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},is=["onClick"],ds={class:"flex justify-between px-2"},cs={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},us={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},ms={key:1,class:"flex justify-center p-5 text-gray-400"},ps={class:"text-base text-gray-500 cursor-pointer"},ys={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},fs={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:s}){const e=t,r=J(),S=ee(),v=ae(),{t:w}=Z(),f=X(null),A=I(()=>f.value?S.taxTypes.filter(function(C){return C.name.toLowerCase().indexOf(f.value.toLowerCase())!==-1}):S.taxTypes),p=I(()=>e.store[e.storeProp].taxes);function V(C,d){s("select:taxType",z({},C)),d()}function D(){r.openModal({title:w("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:C=>s("select:taxType",C)})}return(C,d)=>{const l=y("BaseIcon"),m=y("BaseInput");return i(),$("div",ss,[a(o(Fe),{class:"relative"},{default:c(({isOpen:u})=>[a(o(Oe),{class:W([u?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[a(l,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),U(" "+_(C.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",os,[a(Le,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[a(o(ze),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:P})=>[n("div",as,[n("div",ns,[n("div",rs,[a(m,{modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=x=>f.value=x),placeholder:C.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),o(A).length>0?(i(),$("div",ls,[(i(!0),$(K,null,oe(o(A),(x,T)=>(i(),$("div",{key:T,class:W([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":o(p).find(M=>M.tax_type_id===x.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:M=>V(x,P)},[n("div",ds,[n("label",cs,_(x.name),1),n("label",us,_(x.percent)+" % ",1)])],10,is))),128))])):(i(),$("div",ms,[n("label",ps,_(C.$t("general.no_tax_found")),1)]))]),o(v).hasAbilities(o(ne).CREATE_TAX_TYPE)?(i(),$("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:D},[a(l,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",ys,_(C.$t("estimates.add_new_tax")),1)])):N("",!0)])]),_:1})]),_:1})])]),_:1})])}}},xs={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},gs={class:"flex items-center justify-between w-full"},hs={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},_s={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},bs={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},vs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},$s={key:0,class:"flex items-center justify-between w-full mt-2"},ws={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Ss={key:3,class:"flex",style:{width:"140px"},role:"group"},Bs={class:"flex items-center"},Is={key:1},ks={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},Ps={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},Ts={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},lo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const s=t,e=X(null);re("$utils");const r=te(),S=I({get:()=>s.store[s.storeProp].discount,set:d=>{s.store[s.storeProp].discount_type==="percentage"?s.store[s.storeProp].discount_val=Math.round(s.store.getSubTotal*d/100):s.store[s.storeProp].discount_val=Math.round(d*100),s.store[s.storeProp].discount=d}}),v=I({get:()=>s.store[s.storeProp].taxes,set:d=>{s.store.$patch(l=>{l[s.storeProp].taxes=d})}}),w=I(()=>{let d=[];return s.store[s.storeProp].items.forEach(l=>{l.taxes&&l.taxes.forEach(m=>{let u=d.find(P=>P.tax_type_id===m.tax_type_id);u?u.amount+=m.amount:m.tax_type_id&&d.push({tax_type_id:m.tax_type_id,amount:m.amount,percent:m.percent,name:m.name})})}),d}),f=I(()=>s.currency?s.currency:r.selectedCompanyCurrency);function A(){s.store[s.storeProp].discount_type!=="fixed"&&(s.store[s.storeProp].discount_val=Math.round(s.store[s.storeProp].discount*100),s.store[s.storeProp].discount_type="fixed")}function p(){s.store[s.storeProp].discount_type!=="percentage"&&(s.store[s.storeProp].discount_val=s.store.getSubTotal*s.store[s.storeProp].discount/100,s.store[s.storeProp].discount_type="percentage")}function V(d){let l=0;d.compound_tax&&s.store.getSubtotalWithDiscount?l=Math.round((s.store.getSubtotalWithDiscount+s.store.getTotalSimpleTax)*d.percent/100):s.store.getSubtotalWithDiscount&&d.percent&&(l=Math.round(s.store.getSubtotalWithDiscount*d.percent/100));let m=Y(z({},ne),{id:he.raw(),name:d.name,percent:d.percent,compound_tax:d.compound_tax,tax_type_id:d.id,amount:l});s.store.$patch(u=>{u[s.storeProp].taxes.push(z({},m))})}function D(d){const l=s.store[s.storeProp].taxes.find(m=>m.id===d.id);l&&Object.assign(l,z({},d))}function C(d){const l=s.store[s.storeProp].taxes.findIndex(m=>m.id===d);s.store.$patch(m=>{m[s.storeProp].taxes.splice(l,1)})}return(d,l)=>{const m=y("BaseContentPlaceholdersText"),u=y("BaseContentPlaceholders"),P=y("BaseFormatMoney"),x=y("BaseInput"),T=y("BaseIcon"),M=y("BaseButton"),h=y("BaseDropdownItem"),b=y("BaseDropdown");return i(),$("div",xs,[n("div",gs,[t.isLoading?(i(),j(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",hs,_(d.$t("estimates.sub_total")),1)),t.isLoading?(i(),j(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",_s,[a(P,{amount:t.store.getSubTotal,currency:o(f)},null,8,["amount","currency"])]))]),(i(!0),$(K,null,oe(o(w),k=>(i(),$("div",{key:k.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(i(),j(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(i(),$("label",bs,_(k.name)+" - "+_(k.percent)+"% ",1)):N("",!0),t.isLoading?(i(),j(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(i(),$("label",vs,[a(P,{amount:k.amount,currency:o(f)},null,8,["amount","currency"])])):N("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(i(),$("div",$s,[t.isLoading?(i(),j(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",ws,_(d.$t("estimates.discount")),1)),t.isLoading?(i(),j(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(i(),$("div",Ss,[a(x,{modelValue:o(S),"onUpdate:modelValue":l[0]||(l[0]=k=>H(S)?S.value=k:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),a(b,{position:"bottom-end"},{activator:c(()=>[a(M,{class:"rounded-tr-md rounded-br-md p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",Bs,[U(_(t.store[t.storeProp].discount_type=="fixed"?o(f).symbol:"%")+" ",1),a(T,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1})]),default:c(()=>[a(h,{onClick:A},{default:c(()=>[U(_(d.$t("general.fixed")),1)]),_:1}),a(h,{onClick:p},{default:c(()=>[U(_(d.$t("general.percentage")),1)]),_:1})]),_:1})]))])):N("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(i(),$("div",Is,[(i(!0),$(K,null,oe(o(v),(k,q)=>(i(),j(ts,{key:k.id,index:q,tax:k,taxes:o(v),currency:t.currency,store:t.store,onRemove:C,onUpdate:D},null,8,["index","tax","taxes","currency","store"]))),128))])):N("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(i(),$("div",{key:2,ref:(k,q)=>{q.taxModal=k,e.value=k},class:"float-right pt-2 pb-4"},[a(fs,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":V},null,8,["store-prop","store","type"])],512)):N("",!0),n("div",ks,[t.isLoading?(i(),j(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",Ps,_(d.$t("estimates.total"))+" "+_(d.$t("estimates.amount"))+":",1)),t.isLoading?(i(),j(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",Ts,[a(P,{amount:t.store.getTotal,currency:o(f)},null,8,["amount","currency"])]))])])}}},Cs={class:"flex text-gray-800 font-medium text-sm mb-2"},Ms=n("span",{class:"text-sm text-red-500"}," *",-1),io={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const s=t,e=J(),{t:r}=Z();function S(){let v="";s.storeProp=="newEstimate"?v=r("estimates.mark_as_default_estimate_template_description"):s.storeProp=="newInvoice"&&(v=r("invoices.mark_as_default_invoice_template_description")),e.openModal({title:r("general.choose_template"),componentName:"SelectTemplate",data:{templates:s.store.templates,store:s.store,storeProp:s.storeProp,isMarkAsDefault:s.isMarkAsDefault,markAsDefaultDescription:v}})}return(v,w)=>{const f=y("BaseIcon"),A=y("BaseButton");return i(),$("div",null,[n("label",Cs,[U(_(v.$t("general.select_template"))+" ",1),Ms]),a(A,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200 capitalize",variant:"gray",onClick:S},{right:c(p=>[a(f,{name:"PencilIcon",class:W(p.class)},null,8,["class"])]),default:c(()=>[U(" "+_(t.store[t.storeProp].template_name),1)]),_:1})])}}},As={class:"mb-6"},Ds={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},Vs={class:"text-gray-800 font-medium mb-4 text-sm"},co={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const s=t;function e(r){s.store[s.storeProp].notes=""+r.notes}return(r,S)=>{const v=y("BaseCustomInput");return i(),$("div",As,[n("div",Ds,[a(Xe,{type:t.type,onSelect:e},null,8,["type"])]),n("label",Vs,_(r.$t("invoices.notes")),1),a(v,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":S[0]||(S[0]=w=>t.store[t.storeProp].notes=w),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},js={class:"flex justify-between w-full"},qs={class:"px-8 py-8 sm:p-6"},Us={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Es=["onClick"],Ns=["src","alt"],Os=["alt","src"],Ls={key:1,class:"z-0 flex ml-3 pt-5"},zs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},uo={setup(t){const s=J(),e=ae(),r=X(""),S=I(()=>s.active&&s.componentName==="SelectTemplate"),v=I(()=>s.title);function w(){s.data.store[s.data.storeProp].template_name?r.value=s.data.store[s.data.storeProp].template_name:r.value=s.data.templates[0]}async function f(){await s.data.store.setTemplate(r.value),!s.data.store.isEdit&&s.data.isMarkAsDefault&&(s.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:r.value}}):s.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:r.value}})),p()}function A(){return new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANDSURBVHgB1ZnPTxNBFMe/b4AExUQSlXjRbDxoTEwsifEo5S9gjRrQg4onL0b+AUTkHwBP3tSLgfgjezDxyPoX0IOJxAtFb/6IvWAxyI7vTbtlC0vplN12+RzohN1hP7zZN515Q2gR113q70VvTqNrBCpwSCNHoH4N3S/XuV0KoIsElKD1R/6VP++d99EiBEvG3M95kVOk74ZSzT+MSprgbQYbc6+9CwW7vhaCIJriZh7J4HOkxznKxWZu3lNUhviQ6pvSOphAChCp2XKwNu15g6WG9zW6yFF0+C8tctNBuhQ5usONoqt2u3DL/ZLj/3YJ6UvCPIMDcsP9lNvthtiIiqQmvWibLPtFku2f3hiOS7Qdom0c7ljMzKCDwe2vQd3QS+J0UlIwo8gOxiVCnahkNzooGcGputSoDX11yFeQJSozgS/NrYgSPUfWqHzBVJryQ6aFLupeQhapRtVEtAs9D5FRNMiVTyNKBBdt4MrwUZwY6LHqo4juyAzQXVkNpT+xXxs9huujx/FnLcDM5FcUi3+b6iduspyUiOaRMqGkcLhPYXLmtE13M/yKx30IKRKVDPnw/jfsCBylgdSGPU7y7cIvvFn4CRt4cXRRcUgdWHL/wUk8fXamYWIkJSnIFkfZJtLtewMYqmbv5JNTsbJJSgriqGw7Xbp8pNaOk01aMkTJssqmw8yjb/jxfQNxsmlJiiONucsr3HJsOsZFUuZHmXqSlqyIoiBZb7VtFSSi2yOblqTAjiXOeqyiBeJkQ5KUNHABQ7LeQ4vEySYuWcFX61gv2CZUlKhsGpLiJss8sx696S7Pcqklm0s9ohfz786NmwzYz/CnjdSp5NOIVvclPrKHH+7xt+YUraeRNbiIFjZrouaF1ZhDRtDsEi1C1M3SZZQfQwpWnYfX/8alRp2oKf3xrm8/01UCmMre9jLkjtWThJs0dURWnqm0uhpXfoxd5r3yzhZEFm18DcwKiZ8pz46/3oADUcgVpOO6Lg+mORtIdssz9qrl2xw2ONX6VB7JIIcN080e6Vgf30g1OsDmBO8MR1o5vgm0fkn8lW175mQtGsUc6UiEuTYg227Z0UYPxLhdIqJCEOhVkZOV2l6nH7vxH+OylVHYXSZdAAAAAElFTkSuQmCC",self.location)}function p(){s.closeModal(),setTimeout(()=>{s.$reset()},300)}return(V,D)=>{const C=y("BaseIcon"),d=y("BaseCheckbox"),l=y("BaseButton"),m=y("BaseModal");return i(),j(m,{show:o(S),onClose:p,onOpen:w},{header:c(()=>[n("div",js,[U(_(o(v))+" ",1),a(C,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:p})])]),default:c(()=>[n("div",qs,[o(s).data?(i(),$("div",Us,[(i(!0),$(K,null,oe(o(s).data.templates,(u,P)=>(i(),$("div",{key:P,class:W([{"border border-solid border-primary-500":r.value===u.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:x=>r.value=u.name},[n("img",{src:u.path,alt:u.name,class:"w-full min-h-[100px]"},null,8,Ns),r.value===u.name?(i(),$("img",{key:0,alt:u.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:A()},null,8,Os)):N("",!0),n("span",{class:W(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":r.value===u.name,"text-gray-600":r.value!=u.name}])},_(u.name),3)],10,Es))),128))])):N("",!0),o(s).data.store.isEdit?N("",!0):(i(),$("div",Ls,[a(d,{modelValue:o(s).data.isMarkAsDefault,"onUpdate:modelValue":D[0]||(D[0]=u=>o(s).data.isMarkAsDefault=u),"set-initial-value":!1,variant:"primary",label:V.$t("general.mark_as_default"),description:o(s).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",zs,[a(l,{class:"mr-3",variant:"primary-outline",onClick:p},{default:c(()=>[U(_(V.$t("general.cancel")),1)]),_:1}),a(l,{variant:"primary",onClick:D[1]||(D[1]=u=>f())},{left:c(u=>[a(C,{name:"SaveIcon",class:W(u.class)},null,8,["class"])]),default:c(()=>[U(" "+_(V.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Fs={class:"flex justify-between w-full"},Rs={class:"item-modal"},Ys=["onSubmit"],Xs={class:"px-8 py-8 sm:p-6"},Qs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},mo={emits:["newItem"],setup(t,{emit:s}){const e=J(),r=fe(),S=te(),v=ee();Me(),Ae();const{t:w}=Z(),f=X(!1),A=X(S.selectedCompanySettings.tax_per_item),p=I(()=>e.active&&e.componentName==="ItemModal"),V=I({get:()=>r.currentItem.price/100,set:x=>{r.currentItem.price=Math.round(x*100)}}),D=I({get:()=>r.currentItem.taxes.map(x=>{if(x)return Y(z({},x),{tax_type_id:x.id,tax_name:x.name+" ("+x.percent+"%)"})}),set:x=>{r.$patch(T=>{T.currentItem.taxes=x})}}),C=I(()=>A.value==="YES"),d={name:{required:O.withMessage(w("validation.required"),Q),minLength:O.withMessage(w("validation.name_min_length",{count:3}),Re(3))},hsn_sac:{maxLength:O.withMessage(w("validation.invalid_hsn",{count:8}),se(8)),numeric:O.withMessage(w("validation.numbers_only"),Ye)},description:{maxLength:O.withMessage(w("validation.description_maxlength",{count:255}),se(255))}},l=ie(d,I(()=>r.currentItem)),m=I(()=>v.taxTypes.map(x=>Y(z({},x),{tax_name:x.name+" ("+x.percent+"%)"})));_e(()=>{l.value.$reset(),r.fetchItemUnits({limit:"all"})});async function u(){if(l.value.$touch(),l.value.$invalid)return!0;let x=Y(z({},r.currentItem),{taxes:r.currentItem.taxes.map(M=>({tax_type_id:M.id,amount:V.value*M.percent/100,percent:M.percent,name:M.name,collective_tax:0}))});f.value=!0,await(r.isEdit?r.updateItem:r.addItem)(x).then(M=>{f.value=!1,M.data.data&&e.data&&e.refreshData(M.data.data),P()})}function P(){e.closeModal(),setTimeout(()=>{r.resetCurrentItem(),e.$reset(),l.value.$reset()},300)}return(x,T)=>{const M=y("BaseIcon"),h=y("BaseInput"),b=y("BaseInputGroup"),k=y("BaseMoney"),q=y("BaseMultiselect"),g=y("BaseTextarea"),B=y("BaseInputGrid"),L=y("BaseButton"),R=y("BaseModal");return i(),j(R,{show:o(p),onClose:P},{header:c(()=>[n("div",Fs,[U(_(o(e).title)+" ",1),a(M,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:P})])]),default:c(()=>[n("div",Rs,[n("form",{action:"",onSubmit:be(u,["prevent"])},[n("div",Xs,[a(B,null,{default:c(()=>[a(b,{label:x.$t("items.name"),required:"",error:o(l).name.$error&&o(l).name.$errors[0].$message},{default:c(()=>[a(h,{modelValue:o(r).currentItem.name,"onUpdate:modelValue":T[0]||(T[0]=E=>o(r).currentItem.name=E),type:"text",invalid:o(l).name.$error,onInput:T[1]||(T[1]=E=>o(l).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(b,{label:x.$t("items.hsn_sac"),error:o(l).hsn_sac.$error&&o(l).hsn_sac.$errors[0].$message},{default:c(()=>[a(h,{modelValue:o(r).currentItem.hsn_sac,"onUpdate:modelValue":T[2]||(T[2]=E=>o(r).currentItem.hsn_sac=E),type:"text",invalid:o(l).hsn_sac.$error,onInput:T[3]||(T[3]=E=>o(l).hsn_sac.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(b,{label:x.$t("items.price")},{default:c(()=>[a(k,{key:o(S).selectedCompanyCurrency,modelValue:o(V),"onUpdate:modelValue":T[4]||(T[4]=E=>H(V)?V.value=E:null),currency:o(S).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"])]),_:1},8,["label"]),a(b,{label:x.$t("items.unit")},{default:c(()=>[a(q,{modelValue:o(r).currentItem.unit_id,"onUpdate:modelValue":T[5]||(T[5]=E=>o(r).currentItem.unit_id=E),label:"name",options:o(r).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:x.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),o(C)?(i(),j(b,{key:0,label:x.$t("items.taxes")},{default:c(()=>[a(q,{modelValue:o(D),"onUpdate:modelValue":T[6]||(T[6]=E=>H(D)?D.value=E:null),options:o(m),mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):N("",!0),a(b,{label:x.$t("items.description"),error:o(l).description.$error&&o(l).description.$errors[0].$message},{default:c(()=>[a(g,{modelValue:o(r).currentItem.description,"onUpdate:modelValue":T[7]||(T[7]=E=>o(r).currentItem.description=E),rows:"4",cols:"50",invalid:o(l).description.$error,onInput:T[8]||(T[8]=E=>o(l).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Qs,[a(L,{class:"mr-3",variant:"primary-outline",type:"button",onClick:P},{default:c(()=>[U(_(x.$t("general.cancel")),1)]),_:1}),a(L,{loading:f.value,disabled:f.value,variant:"primary",type:"submit"},{left:c(E=>[a(M,{name:"SaveIcon",class:W(E.class)},null,8,["class"])]),default:c(()=>[U(" "+_(o(r).isEdit?x.$t("general.update"):x.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Ys)])]),_:1},8,["show"])}}},Ws={class:"flex justify-between w-full"},Js={class:"flex flex-col"},Zs={class:"text-sm text-gray-500 mt-1"},Gs=["onSubmit"],Hs={class:"p-4 sm:p-6"},Ks={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},eo={emits:["addTax"],setup(t,{emit:s}){const e=J();De();const r=xe({state:"",city:"",address_street_1:"",zip:""}),S=X(!1),v=ee(),{t:w}=Z(),f=I(()=>e.active&&e.componentName==="TaxationAddressModal"),A=I(()=>({state:{required:O.withMessage(w("validation.required"),Q)},city:{required:O.withMessage(w("validation.required"),Q)},address_street_1:{required:O.withMessage(w("validation.required"),Q)},zip:{required:O.withMessage(w("validation.required"),Q)}})),p=ie(A,I(()=>r));async function V(){if(p.value.$touch(),p.value.$invalid)return!0;let d={address:r};e.id&&(d.customer_id=e.id),r.address_street_1=r.address_street_1.replace(/(\r\n|\n|\r)/gm,""),S.value=!0,await v.fetchSalesTax(d).then(l=>{S.value=!1,s("addTax",l.data.data),C()}).catch(l=>{S.value=!1})}function D(){var d,l,m,u;r.state=(d=e==null?void 0:e.data)==null?void 0:d.state,r.city=(l=e==null?void 0:e.data)==null?void 0:l.city,r.address_street_1=(m=e==null?void 0:e.data)==null?void 0:m.address_street_1,r.zip=(u=e==null?void 0:e.data)==null?void 0:u.zip}function C(){e.closeModal()}return(d,l)=>{const m=y("BaseIcon"),u=y("BaseInput"),P=y("BaseInputGroup"),x=y("BaseTextarea"),T=y("BaseInputGrid"),M=y("BaseButton"),h=y("BaseModal");return i(),j(h,{show:o(f),onClose:C,onOpen:D},{header:c(()=>[n("div",Ws,[n("div",Js,[U(_(o(e).title)+" ",1),n("p",Zs,_(o(e).content),1)]),a(m,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:C})])]),default:c(()=>[n("form",{onSubmit:be(V,["prevent"])},[n("div",Hs,[a(T,{layout:"one-column"},{default:c(()=>[a(P,{required:"",error:o(p).state.$error&&o(p).state.$errors[0].$message,label:d.$t("customers.state")},{default:c(()=>[a(u,{modelValue:o(r).state,"onUpdate:modelValue":l[0]||(l[0]=b=>o(r).state=b),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(p).state.$error,onInput:l[1]||(l[1]=b=>o(p).state.$touch()),placeholder:d.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(P,{required:"",error:o(p).city.$error&&o(p).city.$errors[0].$message,label:d.$t("customers.city")},{default:c(()=>[a(u,{modelValue:o(r).city,"onUpdate:modelValue":l[2]||(l[2]=b=>o(r).city=b),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(p).city.$error,onInput:l[3]||(l[3]=b=>o(p).city.$touch()),placeholder:d.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(P,{required:"",error:o(p).address_street_1.$error&&o(p).address_street_1.$errors[0].$message,label:d.$t("customers.address")},{default:c(()=>[a(x,{modelValue:o(r).address_street_1,"onUpdate:modelValue":l[4]||(l[4]=b=>o(r).address_street_1=b),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(p).address_street_1.$error,onInput:l[5]||(l[5]=b=>o(p).address_street_1.$touch()),placeholder:d.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(P,{required:"",error:o(p).zip.$error&&o(p).zip.$errors[0].$message,label:d.$t("customers.zip_code")},{default:c(()=>[a(u,{modelValue:o(r).zip,"onUpdate:modelValue":l[6]||(l[6]=b=>o(r).zip=b),invalid:o(p).zip.$error,onInput:l[7]||(l[7]=b=>o(p).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:d.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",Ks,[a(M,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:C},{default:c(()=>[U(_(d.$t("general.cancel")),1)]),_:1}),a(M,{loading:S.value,variant:"primary",type:"submit"},{left:c(b=>[S.value?N("",!0):(i(),j(m,{key:0,name:"SaveIcon",class:W(b.class)},null,8,["class"]))]),default:c(()=>[U(" "+_(d.$t("general.save")),1)]),_:1},8,["loading"])])],40,Gs)]),_:1},8,["show"])}}},po={props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const s=t,e="Sales Tax",r="MODULE",S=J(),v=te(),w=ee(),{t:f}=Z(),A=X(!1),p=I(()=>s.isEdit?s.store[s.storeProp].sales_tax_address_type==="billing":v.selectedCompanySettings.sales_tax_address_type==="billing"),V=I(()=>v.selectedCompanySettings.sales_tax_us_enabled==="YES"),D=I(()=>s.isEdit?s.store[s.storeProp].sales_tax_type==="customer_level":v.selectedCompanySettings.sales_tax_type==="customer_level"),C=I(()=>s.isEdit?s.store[s.storeProp].sales_tax_type==="company_level":v.selectedCompanySettings.sales_tax_type==="company_level"),d=I(()=>{if(D.value&&l.value){let h=p.value?s.customer.billing:s.customer.shipping;return{address:G.exports.pick(h,["address_street_1","city","state","zip"]),customer_id:s.customer.id}}else if(C.value&&l.value)return{address:G.exports.pick(address,["address_street_1","city","state","zip"])}}),l=I(()=>{var h,b;if(D.value){let k=p.value?(h=s.customer)==null?void 0:h.billing:(b=s.customer)==null?void 0:b.shipping;return m(k)}else if(C.value)return m(v.selectedCompany.address);return!1});le(()=>s.customer,(h,b)=>{if(h&&b&&D.value){u(h,b);return}!l.value&&D.value&&h?setTimeout(()=>{P()},500):D.value&&h?x():D.value&&!h&&M()}),_e(()=>{C.value&&(l.value?x():P())});function m(h){return h?h.address_street_1&&h.city&&h.state&&h.zip:!1}function u(h,b){const k=p.value?h.billing:h.shipping,q=p.value?b.billing:b.shipping,g=G.exports.pick(k,["address_street_1","city","state","zip"]),B=G.exports.pick(q,["address_street_1","city","state","zip"]);G.exports.isEqual(g,B)||x()}function P(){var k,q;if(!V.value)return;let h=null,b="";D.value?p.value?(h=(k=s.customer)==null?void 0:k.billing,b=f("settings.taxations.add_billing_address")):(h=(q=s.customer)==null?void 0:q.shipping,b=f("settings.taxations.add_shipping_address")):(h=v.selectedCompany.address,b=f("settings.taxations.add_company_address")),S.openModal({title:b,content:f("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:h,id:D.value?s.customer.id:""})}async function x(){!V.value||(A.value=!0,await w.fetchSalesTax(d.value).then(h=>{T(h.data.data),A.value=!1}).catch(h=>{h.response.data.error&&setTimeout(()=>{P()},500),A.value=!1}))}function T(h){h.tax_type_id=h.id;const b=s.store[s.storeProp].taxes.findIndex(k=>k.name===e&&k.type===r);b>-1?Object.assign(s.store[s.storeProp].taxes[b],h):s.store[s.storeProp].taxes.push(h)}function M(){const h=s.store[s.storeProp].taxes.findIndex(k=>k.name===e&&k.type===r);h>-1&&s.store[s.storeProp].taxes.splice(h,1);let b=w.taxTypes.findIndex(k=>k.name===e&&k.type===r);b>-1&&w.taxTypes.splice(b,1)}return(h,b)=>(i(),j(eo,{onAddTax:T}))}};export{uo as _,mo as a,po as b,ro as c,co as d,io as e,lo as f};
