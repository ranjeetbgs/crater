var de=Object.defineProperty;var R=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var G=(_,n,l)=>n in _?de(_,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[n]=l,O=(_,n)=>{for(var l in n||(n={}))ie.call(n,l)&&G(_,l,n[l]);if(R)for(var l of R(n))ce.call(n,l)&&G(_,l,n[l]);return _};import{z as ue,C as me,a0 as q,B as v,k as S,A as fe,Y as pe,X as _e,r as i,o as m,e as h,f as s,w as r,u as a,j as x,l as $,i as ye,t as B,h as d,F as X,y as he,m as ge}from"./vendor.5f3776de.js";import{c as be,e as ve,d as xe,j as Be,g as J}from"./main.e56a056f.js";import{u as ke}from"./payment.2d6fd28c.js";import{_ as we,a as Ie}from"./SendPaymentModal.44371139.js";import{L as Fe}from"./LoadingIcon.4fc67c12.js";import"./mail-driver.ea8d0054.js";const Se=["href"],Pe={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},Te={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},Ve={class:"flex ml-3",role:"group","aria-label":"First group"},$e={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},je={class:"px-2"},De={class:"px-2"},Le={class:"px-2"},Me={class:"flex-2"},Ne={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},ze={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Ye={class:"flex-1 whitespace-nowrap right"},Ae={class:"text-sm text-right text-gray-500 non-italic"},Ce={key:0,class:"flex justify-center p-4 items-center"},Ee={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ue={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},He=["src"],Qe={setup(_){const n=ue(),{t:l}=me();let f=q({}),o=q({orderBy:null,orderByField:null,searchText:null}),k=v(!1),P=v(!1);const w=ke(),K=be(),z=ve();xe();const p=v(null),I=v(1),j=v(1),Y=v(null),Q=S(()=>f.payment_number||""),A=S(()=>o.orderBy==="asc"||o.orderBy==null);S(()=>A.value?l("general.ascending"):l("general.descending"));const C=S(()=>f.unique_hash?`/payments/pdf/${f.unique_hash}`:!1);S(()=>{var t;return fe((t=w==null?void 0:w.selectedPayment)==null?void 0:t.payment_date).format("YYYY/MM/DD")}),pe(n,()=>{E()}),T(),E(),y=_e.exports.debounce(y,500);function W(t){return n.params.id==t}Be();async function T(t,c=!1){if(k.value)return;let u={};o.searchText!==""&&o.searchText!==null&&o.searchText!==void 0&&(u.search=o.searchText),o.orderBy!==null&&o.orderBy!==void 0&&(u.orderBy=o.orderBy),o.orderByField!==null&&o.orderByField!==void 0&&(u.orderByField=o.orderByField),k.value=!0;let g=await w.fetchPayments(O({page:t},u));k.value=!1,p.value=p.value?p.value:[],p.value=[...p.value,...g.data.data],I.value=t||1,j.value=g.data.meta.last_page;let V=p.value.find(D=>D.id==n.params.id);c==!1&&!V&&I.value<j.value&&Object.keys(u).length===0&&T(++I.value),V&&setTimeout(()=>{c==!1&&Z()},500)}async function E(){if(!n.params.id)return;P.value=!0;let t=await w.fetchPayment(n.params.id);t.data&&(P.value=!1,Object.assign(f,t.data.data))}function Z(){const t=document.getElementById(`payment-${n.params.id}`);t&&(t.scrollIntoView({behavior:"smooth"}),t.classList.add("shake"),ee())}function ee(){Y.value.addEventListener("scroll",t=>{t.target.scrollTop>0&&t.target.scrollTop+t.target.clientHeight>t.target.scrollHeight-200&&I.value<j.value&&T(++I.value,!0)})}async function y(){p.value=[],T()}function te(){return o.orderBy==="asc"?(o.orderBy="desc",y(),!0):(o.orderBy="asc",y(),!0)}async function ae(){K.openModal({title:l("payments.send_payment"),componentName:"SendPaymentModal",id:f.id,data:f,variant:"lg"})}return(t,c)=>{const u=i("BaseIcon"),g=i("BaseButton"),V=i("BasePageHeader"),D=i("BaseInput"),L=i("BaseRadio"),M=i("BaseInputGroup"),N=i("BaseDropdownItem"),oe=i("BaseDropdown"),se=i("BaseText"),ne=i("BaseFormatMoney"),re=i("router-link"),le=i("BasePage");return m(),h(X,null,[s(we),s(le,{class:"xl:pl-96"},{default:r(()=>{var U;return[s(V,{title:a(Q)},{actions:r(()=>{var e,b,F;return[a(z).hasAbilities(a(J).SEND_PAYMENT)?(m(),h("a",{key:0,href:`https://api.whatsapp.com/send?phone=91${(e=a(f).customer)==null?void 0:e.phone}&text=Hey, ${(b=a(f).customer)==null?void 0:b.name}.%0aYour payment of INR ${((F=a(f))==null?void 0:F.amount)/100} has been received. Thank you!
        `,class:"mr-5 text-primary-500 flex flex-col",target:"_blank"},[s(u,{name:"ShareIcon"})],8,Se)):x("",!0),a(z).hasAbilities(a(J).SEND_PAYMENT)?(m(),$(g,{key:1,"content-loading":a(P),variant:"primary",onClick:ae},{default:r(()=>[ye(B(t.$t("payments.send_payment_receipt")),1)]),_:1},8,["content-loading"])):x("",!0),s(Ie,{"content-loading":a(P),class:"ml-3",row:a(f)},null,8,["content-loading","row"])]}),_:1},8,["title"]),d("div",Pe,[d("div",Te,[s(D,{modelValue:a(o).searchText,"onUpdate:modelValue":c[0]||(c[0]=e=>a(o).searchText=e),placeholder:t.$t("general.search"),type:"text",onInput:y},{default:r(()=>[s(u,{name:"SearchIcon",class:"h-5"})]),_:1},8,["modelValue","placeholder"]),d("div",Ve,[s(oe,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:r(()=>[s(g,{variant:"gray"},{default:r(()=>[s(u,{name:"FilterIcon"})]),_:1})]),default:r(()=>[d("div",$e,B(t.$t("general.sort_by")),1),d("div",je,[s(N,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[s(M,{class:"-mt-3 font-normal"},{default:r(()=>[s(L,{id:"filter_invoice_number",modelValue:a(o).orderByField,"onUpdate:modelValue":[c[1]||(c[1]=e=>a(o).orderByField=e),y],label:t.$t("invoices.title"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})]),d("div",De,[s(N,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[s(M,{class:"-mt-3 font-normal"},{default:r(()=>[s(L,{modelValue:a(o).orderByField,"onUpdate:modelValue":[c[2]||(c[2]=e=>a(o).orderByField=e),y],label:t.$t("payments.date"),size:"sm",name:"filter",value:"payment_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),d("div",Le,[s(N,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[s(M,{class:"-mt-3 font-normal"},{default:r(()=>[s(L,{id:"filter_payment_number",modelValue:a(o).orderByField,"onUpdate:modelValue":[c[3]||(c[3]=e=>a(o).orderByField=e),y],label:t.$t("payments.payment_number"),size:"sm",name:"filter",value:"payment_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),s(g,{class:"ml-1",size:"md",variant:"gray",onClick:te},{default:r(()=>[a(A)?(m(),$(u,{key:0,name:"SortAscendingIcon"})):(m(),$(u,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),d("div",{ref:(e,b)=>{b.paymentListSection=e,Y.value=e},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid"},[(m(!0),h(X,null,he(p.value,(e,b)=>(m(),h("div",{key:b},[e?(m(),$(re,{key:0,id:"payment-"+e.id,to:`/admin/payments/${e.id}/view`,class:ge(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":W(e.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:r(()=>{var F,H;return[d("div",Me,[s(se,{text:(F=e==null?void 0:e.customer)==null?void 0:F.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),d("div",Ne,B(e==null?void 0:e.payment_number),1),d("div",ze,B(e==null?void 0:e.invoice_number),1)]),d("div",Ye,[s(ne,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:e==null?void 0:e.amount,currency:(H=e.customer)==null?void 0:H.currency},null,8,["amount","currency"]),d("div",Ae,B(e.formatted_payment_date),1)])]}),_:2},1032,["id","to","class"])):x("",!0)]))),128)),a(k)?(m(),h("div",Ce,[s(Fe,{class:"h-6 m-1 animate-spin text-primary-400"})])):x("",!0),!((U=p.value)==null?void 0:U.length)&&!a(k)?(m(),h("p",Ee,B(t.$t("payments.no_matching_payments")),1)):x("",!0)],512)]),d("div",Ue,[a(C)?(m(),h("iframe",{key:0,src:a(C),class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,He)):x("",!0)])]}),_:1})],64)}}};export{Qe as default};
